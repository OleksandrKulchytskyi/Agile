CREATE TABLE [dbo].[Rooms] (
    [Id] [int] NOT NULL IDENTITY,
    [Name] [nvarchar](max) NOT NULL,
    [Description] [nvarchar](max),
    [Active] [bit] NOT NULL,
    CONSTRAINT [PK_dbo.Rooms] PRIMARY KEY ([Id])
)	
CREATE TABLE [dbo].[Users] (
    [Id] [int] NOT NULL IDENTITY,
    [Name] [nvarchar](50) NOT NULL,
    [Password] [nvarchar](max) NOT NULL,
    [IsAdmin] [bit] NOT NULL,
    [Room_Id] [int],
    CONSTRAINT [PK_dbo.Users] PRIMARY KEY ([Id])
)
CREATE INDEX [IX_Room_Id] ON [dbo].[Users]([Room_Id])
CREATE TABLE [dbo].[UserSessions] (
    [Id] [int] NOT NULL IDENTITY,
    [SessionId] [nvarchar](max) NOT NULL,
    [LastActivity] [datetimeoffset](7),
    [UserAgent] [nvarchar](max),
    [UserId] [int] NOT NULL,
    CONSTRAINT [PK_dbo.UserSessions] PRIMARY KEY ([Id])
)
CREATE INDEX [IX_UserId] ON [dbo].[UserSessions]([UserId])
CREATE TABLE [dbo].[Priviliges] (
    [Id] [int] NOT NULL IDENTITY,
    [Name] [nvarchar](max) NOT NULL,
    [Description] [nvarchar](max),
    CONSTRAINT [PK_dbo.Priviliges] PRIMARY KEY ([Id])
)
CREATE TABLE [dbo].[UserVotes] (
    [Id] [int] NOT NULL IDENTITY,
    [UserId] [int] NOT NULL,
    [VoteId] [int] NOT NULL,
    [Mark] [int] NOT NULL,
    CONSTRAINT [PK_dbo.UserVotes] PRIMARY KEY ([Id])
)
CREATE INDEX [IX_UserId] ON [dbo].[UserVotes]([UserId])
CREATE INDEX [IX_VoteId] ON [dbo].[UserVotes]([VoteId])
CREATE TABLE [dbo].[VoteItems] (
    [Id] [int] NOT NULL IDENTITY,
    [Content] [nvarchar](max) NOT NULL,
    [OverallMark] [int] NOT NULL,
    [RoomId] [int] NOT NULL,
    CONSTRAINT [PK_dbo.VoteItems] PRIMARY KEY ([Id])
)
CREATE INDEX [IX_RoomId] ON [dbo].[VoteItems]([RoomId])
CREATE TABLE [dbo].[UserPrivilege] (
    [PrivilegeId] [int] NOT NULL,
    [UserId] [int] NOT NULL,
    CONSTRAINT [PK_dbo.UserPrivilege] PRIMARY KEY ([PrivilegeId], [UserId])
)
CREATE INDEX [IX_PrivilegeId] ON [dbo].[UserPrivilege]([PrivilegeId])
CREATE INDEX [IX_UserId] ON [dbo].[UserPrivilege]([UserId])
ALTER TABLE [dbo].[Users] ADD CONSTRAINT [FK_dbo.Users_dbo.Rooms_Room_Id] FOREIGN KEY ([Room_Id]) REFERENCES [dbo].[Rooms] ([Id])
ALTER TABLE [dbo].[UserSessions] ADD CONSTRAINT [FK_dbo.UserSessions_dbo.Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[Users] ([Id]) ON DELETE CASCADE
ALTER TABLE [dbo].[UserVotes] ADD CONSTRAINT [FK_dbo.UserVotes_dbo.Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[Users] ([Id]) ON DELETE CASCADE
ALTER TABLE [dbo].[UserVotes] ADD CONSTRAINT [FK_dbo.UserVotes_dbo.VoteItems_VoteId] FOREIGN KEY ([VoteId]) REFERENCES [dbo].[VoteItems] ([Id]) ON DELETE CASCADE
ALTER TABLE [dbo].[VoteItems] ADD CONSTRAINT [FK_dbo.VoteItems_dbo.Rooms_RoomId] FOREIGN KEY ([RoomId]) REFERENCES [dbo].[Rooms] ([Id]) ON DELETE CASCADE
ALTER TABLE [dbo].[UserPrivilege] ADD CONSTRAINT [FK_dbo.UserPrivilege_dbo.Priviliges_PrivilegeId] FOREIGN KEY ([PrivilegeId]) REFERENCES [dbo].[Priviliges] ([Id]) ON DELETE CASCADE
ALTER TABLE [dbo].[UserPrivilege] ADD CONSTRAINT [FK_dbo.UserPrivilege_dbo.Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[Users] ([Id]) ON DELETE CASCADE
CREATE TABLE [dbo].[__MigrationHistory] (
    [MigrationId] [nvarchar](150) NOT NULL,
    [ContextKey] [nvarchar](300) NOT NULL,
    [Model] [varbinary](max) NOT NULL,
    [ProductVersion] [nvarchar](32) NOT NULL,
    CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
)
INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
VALUES (N'201402211514004_InitialVersion', N'WebSignalR.DataAccess.Migrations.Configuration',  0x1F8B0800000000000400E55D5F6FE4B6117F2F90EF20E8A90D90957D41D1F4B09BC0679F13A3F1D9F03AD7478396B86B2212B515B9AEFDD9FAD08FD4AF50527F288A7F244A2BEDAE9D97832D92C3E1F0C7E1CC70C6F7BFFFFC77FED34B127BCF302328C50BFF7476E27B10876984F07AE16FE9EABB1FFC9F7EFCE64FF3CF51F2E27DADFA7DCFFBB191982CFC274A371F8380844F30016496A0304B49BAA2B3304D0210A5C1879393BF07A7A70164247C46CBF3E6775B4C5102F35FD8AFE7290EE1866E417C9D463026E577D6B2CCA97A5F4002C9068470E1FF133E2ED11A83F86E760128380B4348C8ECE293EF9DC508307E96305EF91EC038A580326E3FFE46E09266295E2F37EC0388EF5F3790F55B8198C072151FEBEEAE0B3AF9C01714D4030709C4174B658BFDCC84425F397BF98217FE5D9A367AB03EFF80AF8D0FECD36D966E60465FEFE0AA1C7715F95ED01C17A803C530690C9F9AFD84E9F71F7CEFCB368EC1630C85A424912E699AC19F218619A030BA0594C20C731A305F8236BB3217FFB79A8D6D0DC39AEF5D83975F215ED3A785CF7EF4BD4BF402A3EA4BC9C16F183168B24134DB420387EDB35E4012666853ECD5CE93B7CF751652F42CD6F8294D63087037C75FC0335AE72256E8B1138261C864CDC09C11DFBB8371DE8D3CA14D01F91907CB83DAEF324B93BB342EB1A4343F2CD36D16722E537B9F7B90AD2175E7F48AC284DCA75F530A8D6CF206DEE7E19794D01CE012935AA398BE6251EF512D4266701ED467A9F584F135FE014FD85F4FA63860B780907FA759B4FFA37D45CEA204E109CEDB92DD2E1CC0462C73F4941D1E7224495056DB34246B1D4C406EE3910FBACDD0338AE11A9A19AC9B1F3485A0B6690C6A1D8630C8CFAB5D78BCD52839D160145BDDBAF3E12F77E03DEA8072695707388FBF0242F32B3067B3989D596BF09E197D37AB15315C2806EC9CADD94227BFAAF94CDDDBD207F3BBEB0AF562B62A9341B89794C63B84FD3B342E5BD13682E657E166BD1A06ABD9DC1C7C87601BA43C141AB949BB238D6B90FDBE1715E670639B94977E9FBB725319FCED1CD5BD0C5C099FC1CA99E8B113D00513EF10E8CC20A6E3DCC63D917DF3CC388EE301005708716771BC7BBEF65E77F7715558DABDE03E87A62554D0F3D8584D70ED60B91C9B3342D210E52CE976F883C121FF8C23AFCB4E2A40A9D8590C9EDB98A24D8C42C6C7C2FF5613600B69B1E8266995E6A9AF9EED1B7C016348A1C70D601E4F3C072404918E2D269FA8F985A90398F1F3086276DE08CD00C254D71D08876803E20ECE95718E5A87F32566505B2EE00662AE303AF6C365EAEAE6D4A717B328E2EA92CE3C90A0D58E38CD3AB2C1C26E2AD5B0907D7077C0D9DDEF76C07DAB9E32E74537AFEFB68360B8CB9B4C15D1BD7EA7CBE0D2BF85A3A5B1BDA773A5EDC1D11F2AFDD6B3C1A1E50AAC2151DF4DEE386B891FD7848B0BF9D8B066657D0F78B3EE87CBDC955D7510CCE9964CA70AD2BD8191749B6E2F7583F9F0B8B3B2BF4F3DA7EE89CBDC95DB7C10DC991EDB6C00697D796B574B27B3D9690BF4DADEEB4632230A1B9E7B7F4C5830ABA25D8082474060EE15BE506DE97CCC12524958CC36AADD81C68AB5D53507975E8C36B85894C3E0FA05C74843F80A1DA4642B4F2324373AB0543E8A18F929D44F0791EABC9888D4AA462122EDB05142655847EA660B5DAB27CEC143132B5037453BBE0E3E99424C177AD05CAB831CF478A92E8776AFC1CD6F9058B783C6CD5198400A4A84CF0C058B0FE1E045281C97C7A00301BADF30C1C20D111B7DF11D06AEA3892B712F1DE31621D88D5A8954A963C74340AD465A5060B6BA1CEDAEE168D02C2D17990E108631A5461747A731E06C0E746DA8F3EDBFC311A9E276E2CE176DF3A048C72B3FCC034BDEDEFC1A6C3608AFA53CBEF28BB72C92F8CEBF5BF64F974B0A1A41480C5973825B31134D33B0864A2B0F6447F012658456368CEF9D4789D6CDD1C2A966930D1D7DC7AA1BBAEACD7F2E46D8B2196726F552CBF1922D2DE176741ED55750A30FF37822258841667840384FE36D82EDE6BC7D74F1D02A8F2FBEB853683C9ACA841A0DEEF4AAAC3B9954F54DA7320F14696A8E84B6739A07D6848113486CFA6100484C97B00348CCC38E15247556994CA5FEEA4E4964893596537D3C2A8008FB78349C18139D9CE1621D3D0D6AA4D4259988F4D99D5633174926D76C71A728E526C9E4A4CFFD68A9CBB445710F86485BC2D0503CDAE939C0B16DF0B1EAB0A117DD013550618E8FA67EF40420A7CDB60F9D66ABFB1D471B952A342953B1852BED548A94079946F1E5686052BB5AA3C0C4E64C3AC0C43E741A98886C189984F8E84EA791DC22D36A34B8D3ABDE626452B6F799E961D374316D574A156FEB756F5483EC97832D40A55A9796409D2E2C27180972E6970969FE01AC591F669C58B3BF0DDBB8528304BD37D9183F71747EB5712E5E8C418A2DE1968182CC298EB0BF2DF19B819CF5668ACD1EA1FC59EB8AF054389106E7B0DE6E74689124B58B504022A2A4448EE66514A7BB2C540BEB145D7C8F2DFD19453CA4B37C25EC8AC8A1365BFE2B3E8F51AEADAB0ED700A31524F43EFD1DE285FFE1E4E407A5A674407D674048141F639127E24BEFCC09ED99625998C5C504F81964E113C8FE9C8097BF8C914E6F25D8BF1EF311D10E8E8EBC80706FBBA7550DEE5812B81B2A9432BFEE6DD44908652609B20D4A6FA3986C123C68F563BB6D9EA9262C629CF23F0490963561B7190C51F12706FED6F7884BE197111446B3B04381C92E0AE390C557EF5AE9BF817AA449E4DF17A93A856601D2100A7275C68867E570053593EC945243B3DB6131D4C50CD9B96655CC247A6EA889D4EE4BBB263F77EF7A639EE1921CEBC6D8B13E66BF69F5C664ADE1F538833358F75CED72FCC9F84E712D639699636DCB443052D48699178784D6A1606A7D9A1A1D52EDE1CA015AF120D03205AD8E442B1D1A4EFBD24D03807450F5E45E8B76C8FBACC8C51E541F72D4686979903D329CB8D7941549BBFB2CF3D2337407D6AF0DC28A254170B2DAB0F7540BD66BBFDE917EE9B597FBD4316FAA966BD7AA2DA75BED8D6909E79BABE5F174F4AD565E1F4514464D0057374AAF5EB316AF15AF8C0B3F7A4CD99616BEBEB914C35407662D6B339135E7F19BC80A77DB485DB4DA26B1D5660D2F8933CD54B4A33E2573AD1573B6D518CB4AAC0575ADF574A629ECE526766959B65EED605B91E877B00A3FADBEC4B58CCF56073841019FA8A9E9AEE3B3E48358A223E65454B70A3E4D786AD3F862A82A821CC4604E3ED969EFF7B9F4518B17FB435CD650CDDCD5232C4F942FB5BA70C8A50AD1586C778C8587BD18DEEB6E4E5656D86F479D603E4EA1A09EC6C5CC3AE9FF0060F62441EB9AC4BC5CB66CD0893E5778955686A5C251D5457D9E8414443CC330A3680542CA9A79AA61FE17ECBE8278CBBA7C4E1E6174856FB674B3A56CC930798C1B4521DC3E6D9B3FAF866CF23CBFC9DFB2C9184B606C229E2D71833F6D511C09BE2F0D0F4B1612DCF02D5F33F95E52FEAAB97E1594BEA4D89150293E61AFDFC364133362E4062F01CFB2B2F1D62DC3A6C4E61708AC33909092463D9EFDCAE017252F3FFE1FC90D7D46C5620000 , N'6.0.2-21211')

